# Active Problems Inbox - New Problem Reporting

## üìã Instructions for Reporting Problems

This file is your **direct communication channel** with the LLM for reporting new problems, issues, bugs, or requests.

### How It Works

When you discover an issue or have a request:

1. **Scroll to the bottom** of this file to the section marked "PASTE YOUR PROBLEMS HERE ‚Üì"
2. **Paste your problem description** (can be plain text, structured, or use the template below)
3. **Save this file**
4. **Start a new LLM session** or continue an existing one

The LLM will automatically:
1. ‚úÖ Read this file at session start
2. ‚úÖ Assign a Problem ID (format: `P-YYYY-MM-DD-NNN`)
3. ‚úÖ Add it to `/problems/problems_log.md` as "Active"
4. ‚úÖ Investigate and fix the problem
5. ‚úÖ Remove the fixed portion from this file
6. ‚úÖ Document the fix in `/progress/fixed_issues_log.md`
7. ‚úÖ Update all relevant documentation

---

## üìù Problem Reporting Template (Optional - Use if Helpful)

You can use this structured template or just paste plain text below. Both work!

```markdown
## Problem: [Short descriptive title]
**Reported**: YYYY-MM-DD HH:MM
**Severity**: [CRITICAL / HIGH / MEDIUM / LOW]
**Component**: [Which part of the system - e.g., Dashboard, API, Auth, etc.]
**Reporter**: [Your name or "User"]

**Description**:
[Detailed description of what's wrong - be as specific as possible]

**Steps to Reproduce**:
1. [First step]
2. [Second step]
3. [Third step - where problem occurs]

**Expected Behavior**:
[What should happen]

**Actual Behavior**:
[What actually happens - include error messages if any]

**Additional Context**:
- Error messages (copy/paste exact text)
- Screenshots (describe or reference)
- Logs or stack traces
- Browser/environment details
- Any other relevant information

---
```

---

## üö® Severity Guidelines

Use these guidelines to determine severity level:

### CRITICAL ‚ö†Ô∏è
- **Security vulnerabilities** (data exposure, authentication bypass, XSS, SQL injection)
- **Data loss or corruption** (user data deleted, database inconsistency)
- **Complete system failure** (app won't start, total crash, 500 errors)
- **Authentication broken** (can't log in, unauthorized access)
- **Database connection failures** (can't connect to DB)
- **Payment/billing issues** (incorrect charges, failed payments)

### HIGH üî¥
- **Major features completely broken** (can't connect AWS account, discovery fails)
- **Severe user experience degradation** (extremely slow, constant errors)
- **Data inconsistency** (wrong data displayed, calculations incorrect)
- **Performance severely degraded** (page takes >30 seconds to load)
- **Critical workflow blocked** (can't complete essential task)

### MEDIUM üü°
- **Feature partially broken** (works sometimes, inconsistent behavior)
- **Workaround available** but inconvenient (can achieve goal via alternate method)
- **UI/UX issues** affecting usability (confusing interface, poor layout)
- **Minor data inconsistencies** (stale data, minor calculation errors)
- **Performance issues** (slow but usable, 5-10 second delays)

### LOW üü¢
- **Cosmetic issues** (styling problems, alignment issues, typos)
- **Minor inconveniences** (extra clicks needed, suboptimal flow)
- **Nice-to-have improvements** (feature requests, enhancements)
- **Documentation errors** (outdated docs, missing examples)
- **Edge case bugs** (rarely occurs, specific conditions)

---

## üí° Example Problem Report (For Reference)

This is an example of a well-formatted problem report:

```markdown
## Problem: Dashboard shows $0 cost after connecting AWS account
**Reported**: 2025-12-25 10:30
**Severity**: HIGH
**Component**: Dashboard / Metrics
**Reporter**: User

**Description**:
After connecting a new AWS account via CloudFormation method and successfully
completing resource discovery (status shows 'active'), the dashboard displays
"$0 Cost", "0% Usage", and shows no metrics or resource data. Expected to see
actual AWS usage and cost data immediately after discovery completes.

**Steps to Reproduce**:
1. Log in to platform as client user
2. Navigate to "Connect AWS Account"
3. Select CloudFormation method
4. Deploy stack in AWS Console
5. Verify connection (status becomes 'connected')
6. Wait for discovery to complete (status becomes 'active')
7. Navigate to /client dashboard
8. Observe all metrics show zero/empty

**Expected Behavior**:
Dashboard should immediately display:
- Current month cost (e.g., "$45.67")
- CPU/memory usage percentages (e.g., "23% CPU")
- Instance count (e.g., "5 instances")
- Resource utilization charts with data
- Spot vs On-Demand breakdown

**Actual Behavior**:
Dashboard displays:
- Cost: "$0.00"
- Usage: "0% CPU, 0% Memory"
- Instances: "No instances found"
- All charts are empty
- No resource data visible

Data DOES appear after midnight when the scheduled cron job runs, indicating
the health check system is not being triggered immediately after discovery.

**Additional Context**:
- Discovery worker completes successfully (logs show "Discovery completed")
- Instances ARE created in database (verified via SQL query)
- account.status transitions correctly: pending ‚Üí connected ‚Üí active
- No JavaScript errors in browser console
- Issue occurs consistently on fresh account connections
- Workaround: Wait until midnight OR manually trigger health checks
- Browser: Chrome 120, Firefox 121 (both affected)
- Environment: Production

**Suspected Root Cause**:
Health checks may only run on scheduled cron (midnight), not immediately
after discovery completion. Need to trigger component_health_checks()
right after discovery_worker finishes.
```

---

## ‚úÖ Tips for Effective Problem Reports

1. **Be Specific**:
   - ‚úÖ "DELETE /client/accounts/123 returns HTTP 204 causing JSON parse error"
   - ‚ùå "Delete doesn't work"

2. **Include Context**:
   - Browser and version (Chrome 120, Firefox 121, Safari 17)
   - User role (Admin, Client, Lab user)
   - Account state (fresh connection, existing account, specific AWS region)
   - Timestamp when issue occurred

3. **One Problem Per Report**:
   - Don't combine "Dashboard is slow AND delete button is broken"
   - Submit separate reports for separate issues

4. **Check Existing Issues First**:
   - Look in `/problems/problems_log.md` to see if already reported
   - Check `/progress/fixed_issues_log.md` to see if already fixed

5. **Be Honest About Severity**:
   - Don't mark everything as CRITICAL
   - Use the severity guidelines above
   - LLM will prioritize accordingly

6. **Plain Text is Fine**:
   - Don't worry about perfect formatting
   - Just describe the problem clearly
   - Template is optional, not required

---

## üìö Related Documentation

- **Problem Log**: `/problems/problems_log.md` - All problems (active & fixed)
- **Fixed Issues**: `/progress/fixed_issues_log.md` - Detailed fix documentation
- **Bug Fix Protocol**: `/instructions/fix_protocol.md` - How LLM handles fixes
- **Master Rules**: `/instructions/master_rules.md` - LLM workflow

---

## üîç Recently Fixed Problems (Reference)

These problems were reported here and have been fixed:

### ‚úÖ P-2025-12-25-003: DELETE endpoint HTTP 204 error
**Fixed**: 2025-12-25
**Summary**: DELETE /client/accounts/{id} returned HTTP 204 (No Content) without
response body, causing frontend JSON parsing errors. Fixed by explicitly setting
status_code=200 with success message body.
**File**: backend/api/client_routes.py:84-143

### ‚úÖ P-2025-12-25-002: Dashboard zero data after fresh connection
**Fixed**: 2025-12-25
**Summary**: Dashboard showed $0 and no metrics immediately after account connection.
Fixed by triggering component_health_checks() immediately after discovery_worker
completion instead of waiting for midnight cron.
**File**: backend/workers/discovery_worker.py:334-340

### ‚úÖ P-2025-12-25-001: AWS account takeover vulnerability
**Fixed**: 2025-12-25
**Summary**: CloudFormation onboarding flow lacked global account_id uniqueness check,
allowing one AWS account to be connected to multiple users. Fixed by adding uniqueness
validation before account creation.
**File**: backend/api/onboarding_routes.py:495

---

## üéØ Current Active Problems

**Status**: ‚úÖ No active problems currently (all known issues resolved as of 2025-12-25)

Remaining problems will appear here after you paste them below.

---
---
---

# ‚¨áÔ∏è PASTE YOUR PROBLEMS HERE ‚¨áÔ∏è

## Instructions:
- Paste your problem description below this line
- Can be plain text, bullet points, or use the template above
- Multiple problems? Add them one after another, separated by "---"
- Don't worry about formatting - just describe the issue clearly
- Save this file when done

---

## Your Problem(s) - Add Below This Line:

## INVESTIGATION COMPLETE (2025-12-26) - Session 2

**Status**: 3 problems investigated, 1 FIXED, 2 NOT CODE BUGS

### Investigation Results:

**P-2025-12-26-001: "Zombie Database" (Schema Drift)** ‚ö†Ô∏è ENVIRONMENT ISSUE
- **Investigation**: Reviewed database models.py - schema definition is **CORRECT**
- **Columns exist**: connection_method (line 81), aws_access_key_id (line 89), aws_secret_access_key (line 90)
- **Root cause**: User's local Docker database volume has outdated schema
- **Resolution**: User needs to drop/recreate database OR run migrations
- **Code change**: NONE - this is an environment/deployment issue
- **Reference**: `/problems/problems_log.md#P-2025-12-26-001`

**P-2025-12-26-002: "Partial Commit Bug"** ‚ùå NOT A BUG
- **Investigation**: Reviewed admin.py:722-745
- **Finding**: Code has SINGLE commit at line 745 for both User and Account
- **Structure**: `db.add(user)` ‚Üí `db.flush()` ‚Üí `db.add(account)` ‚Üí `db.commit()`
- **This is CORRECT**: flush() generates ID without committing, final commit saves both atomically
- **If failures occur**: They're due to P-2025-12-26-001 (schema drift) causing entire transaction to fail
- **Code change**: NONE - implementation is correct
- **Reference**: `/problems/problems_log.md#P-2025-12-26-002`

**P-2025-12-26-003: "Status Filter Mismatch"** ‚úÖ FIXED
- **Investigation**: Reviewed client_routes.py:52-55
- **Bug confirmed**: GET /client/accounts filtered by `status.in_(["connected", "active", "warning"])`
- **Problem**: Admin creates placeholder accounts with status="pending" (admin.py:737)
- **Impact**: Pending accounts hidden from user, frontend shows onboarding form
- **Fix applied**: Removed status filter - now returns ALL accounts for user
- **Code changed**: `backend/api/client_routes.py:46-56`
- **Reference**: `/progress/fixed_issues_log.md#P-2025-12-26-003`

### Summary:
- **1 REAL BUG** - Status filter fixed
- **2 NOT BUGS** - Schema drift (environment) and partial commit (code is correct)

---

---

## INVESTIGATION COMPLETE (2025-12-26) - Session 3

**Status**: 3 interconnected problems FIXED

### Investigation Results:

**P-2025-12-26-006: Login Loop - AuthGateway Endpoint** ‚úÖ FIXED
- **Problem**: AuthGateway calling `/client/accounts` instead of `/v1/client/accounts`
- **Impact**: 404 errors, login loop after successful connection
- **Fix**: Updated endpoint path in AuthGateway.jsx:13
- **File**: `frontend/src/components/AuthGateway.jsx`
- **Reference**: `/progress/fixed_issues_log.md#P-2025-12-26-006`

**P-2025-12-26-005: TypeError: de.get is not a function** ‚úÖ FIXED
- **Problem**: API client lacked axios-style `.get()`, `.post()`, `.delete()` methods
- **Impact**: JavaScript crashes when components called `api.get()`
- **Fix**: Rewrote api.js with ApiClient class providing axios interface
- **File**: `frontend/src/services/api.js` (complete rewrite)
- **Reference**: `/progress/fixed_issues_log.md#P-2025-12-26-005`

**P-2025-12-26-004: Multiple Conflicting API Files** ‚úÖ FIXED
- **Problem**: 4 API files existed (api.js, api.jsx, apiClient.jsx, config/api.jsx)
- **Impact**: Bundler randomly picked wrong file, inconsistent behavior
- **Fix**: Deleted api.jsx and apiClient.jsx, kept only api.js
- **Files Deleted**: `api.jsx`, `apiClient.jsx`
- **Reference**: `/progress/fixed_issues_log.md#P-2025-12-26-004`

### Backend Issue Status:

**Note**: The backend status filter issue mentioned in the problem report was already fixed in P-2025-12-26-003 (previous session). GET `/client/accounts` now returns ALL accounts regardless of status.

---

**Note**: No new problems currently pending. Add new problems below this line.
upload model is not working some thing has broken check with the  scanario based description and then update evrything which will fix full application my current console error logs are (API Connected to: /api (PRODUCTION)
index-C4hRaSQ8.js:455 Pipeline data fetch failed: TypeError: ue.getSystemOverview is not a function
    at l (index-C4hRaSQ8.js:455:11198)
    at index-C4hRaSQ8.js:455:13161
    at $d (index-C4hRaSQ8.js:40:24263)
    at Ja (index-C4hRaSQ8.js:40:42318)
    at index-C4hRaSQ8.js:40:40661
    at w (index-C4hRaSQ8.js:25:1557)
    at MessagePort.C (index-C4hRaSQ8.js:25:1919)
l @ index-C4hRaSQ8.js:455
(anonymous) @ index-C4hRaSQ8.js:455
$d @ index-C4hRaSQ8.js:40
Ja @ index-C4hRaSQ8.js:40
(anonymous) @ index-C4hRaSQ8.js:40
w @ index-C4hRaSQ8.js:25
C @ index-C4hRaSQ8.js:25Understand this error
index-C4hRaSQ8.js:463 Failed to fetch models TypeError: ue.getModels is not a function
    at s (index-C4hRaSQ8.js:463:43761)
    at index-C4hRaSQ8.js:463:44059
    at $d (index-C4hRaSQ8.js:40:24263)
    at Ja (index-C4hRaSQ8.js:40:42318)
    at index-C4hRaSQ8.js:40:40661
    at w (index-C4hRaSQ8.js:25:1557)
    at MessagePort.C (index-C4hRaSQ8.js:25:1919)
s @ index-C4hRaSQ8.js:463
(anonymous) @ index-C4hRaSQ8.js:463
$d @ index-C4hRaSQ8.js:40
Ja @ index-C4hRaSQ8.js:40
(anonymous) @ index-C4hRaSQ8.js:40
w @ index-C4hRaSQ8.js:25
C @ index-C4hRaSQ8.js:25Understand this error
index-C4hRaSQ8.js:463 Upload failed: TypeError: ue.uploadModel is not a function
    at l (index-C4hRaSQ8.js:463:44138)
    at onUpload (index-C4hRaSQ8.js:463:52152)
    at v (index-C4hRaSQ8.js:463:45318)
    at onClick (index-C4hRaSQ8.js:463:48032)
    at Object.H$ (index-C4hRaSQ8.js:37:9855)
    at G$ (index-C4hRaSQ8.js:37:10009)
    at q$ (index-C4hRaSQ8.js:37:10066)
    at Pb (index-C4hRaSQ8.js:37:31446)
    at XA (index-C4hRaSQ8.js:37:31863)
    at index-C4hRaSQ8.js:37:36776)
-----
The "Upload Model" failure and the console errors (`TypeError: ue.uploadModel is not a function`) are caused by a **Disconnect between your Frontend Service Definition and Component Usage**.

Specifically, your components expect specific helper functions (like `uploadModel`), but your current `api.js` only exports a raw Axios instance. Additionally, your Backend logs show a crash in the `standalone_pipeline` because of a legacy `flask` dependency.

Here is the **Scenario-Based Fix** to resolve the Upload, Fetch, and Backend Stability issues.

---

### üöÄ **Stage 1: Fix Frontend API Layer (The Root Cause)**

**Scenario:** The `ModelGovernance` component tries to call `api.getModels()` and `api.uploadModel()`.
**Current State:** `api.js` exports `axios.create()`, which has `get` and `post`, but **not** `getModels` or `uploadModel`.
**Fix:** Refactor `api.js` to export a comprehensive service object.

**File:** `frontend/src/services/api.js`
**Action:** Replace the entire content with this robust version:

```javascript
import axios from 'axios';

// 1. Determine Base URL
const getBaseUrl = () => {
  if (import.meta.env.VITE_API_URL) {
    return import.meta.env.VITE_API_URL;
  }
  return window.location.hostname === 'localhost' 
    ? 'http://localhost:8000/api/v1'  // Ensure v1 is included if your backend expects it
    : '/api/v1';
};

// 2. Create Axios Instance
const axiosInstance = axios.create({
  baseURL: getBaseUrl(),
  headers: {
    'Content-Type': 'application/json',
  },
});

// 3. Request Interceptor (Auth Token)
axiosInstance.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// 4. Response Interceptor (Error Handling)
axiosInstance.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response && error.response.status === 401) {
      // Optional: Auto-logout logic
      console.warn('Session expired or unauthorized');
    }
    return Promise.reject(error);
  }
);

// 5. Define The Service Object (The Missing Piece)
const api = {
  // --- Core Methods ---
  get: axiosInstance.get,
  post: axiosInstance.post,
  put: axiosInstance.put,
  delete: axiosInstance.delete,
  patch: axiosInstance.patch,

  // --- Dashboard & System ---
  getSystemOverview: () => axiosInstance.get('/metrics/system-overview'), // Verify endpoint match
  
  // --- AI Model Governance (Fixes your specific error) ---
  getModels: () => axiosInstance.get('/ai/models'),
  
  uploadModel: (formData) => axiosInstance.post('/ai/upload', formData, {
    headers: { 'Content-Type': 'multipart/form-data' }
  }),
  
  deployModel: (modelId) => axiosInstance.post(`/ai/deploy/${modelId}`),
  
  // --- Client ---
  getAccounts: () => axiosInstance.get('/client/accounts'),
  connectAccount: (data) => axiosInstance.post('/onboarding/connect/credentials', data),
};

export default api;

```

---

### ‚öôÔ∏è **Stage 2: Fix Backend "Flask" Crash**

**Scenario:** The backend logs show `ModuleNotFoundError: No module named 'flask'`. This is crashing the `standalone_pipeline` check.
**Cause:** Old code in `standalone_optimizer.py` likely imports Flask, but you are running FastAPI.
**Fix:** Remove the legacy import.

**File:** `backend/pipelines/standalone_optimizer.py`
**Action:** Remove `from flask import ...` or `import flask`.

* If the file uses `jsonify` or `request` from Flask, replace them with standard Python `dict` or FastAPI Pydantic models.
* **Instruction:** "Search for `import flask` or `from flask` in `backend/pipelines/standalone_optimizer.py` and delete those lines. Ensure the class logic uses standard Python data structures instead."

---

### üõ°Ô∏è **Stage 3: Fix Pydantic "Protected Namespace" Warning**

**Scenario:** Logs show `UserWarning: Field "model_version" has conflict with protected namespace "model_"`.
**Cause:** Pydantic v2 reserves field names starting with `model_`.
**Fix:** Add configuration to your Pydantic models.

**File:** `backend/api/ai_routes.py` (or wherever `ModelMetadata` is defined)
**Action:** Add `model_config` to the Pydantic class.

```python
from pydantic import BaseModel, ConfigDict

class ModelMetadata(BaseModel):
    model_name: str
    model_version: str
    # ... other fields
    
    # ADD THIS:
    model_config = ConfigDict(protected_namespaces=()) 

```

---

### üîå **Stage 4: Verify Backend AI Routes**

**Scenario:** Ensure the backend actually accepts the file upload at `/ai/upload`.

**File:** `backend/api/ai_routes.py`
**Action:** Verify/Update the code to handle `UploadFile`.

```python
from fastapi import APIRouter, UploadFile, File, Form, Depends
# ... other imports

router = APIRouter()

@router.post("/upload")
async def upload_model(
    file: UploadFile = File(...),
    description: str = Form(None),
    current_user = Depends(get_current_user)
):
    # 1. Validate File
    if not file.filename.endswith(('.h5', '.pkl', '.onnx', '.pt')):
        raise HTTPException(400, "Invalid file format")
    
    # 2. Save File (Ensure directory exists)
    file_location = f"ml_models/storage/{file.filename}"
    os.makedirs(os.path.dirname(file_location), exist_ok=True)
    
    with open(file_location, "wb+") as file_object:
        file_object.write(await file.read())

    # 3. Register in DB (Pseudo-code)
    # new_model = MLModel(name=file.filename, ...)
    # db.add(new_model)
    
    return {"status": "success", "filename": file.filename}

```

### üßπ **Final Cleanup Step**

1. **Delete** `frontend/src/services/api.jsx` and `frontend/src/services/apiClient.jsx` if they exist. Use **ONLY** `api.js` to prevent import confusion.
2. **Restart** the backend container to clear the "Flask" error.
```bash
docker-compose restart backend

```



**Result:**

* Frontend `api.js` will now have `.uploadModel()`.
* Console error `ue.uploadModel is not a function` will vanish.
* Backend will accept the file without crashing.
_Last Updated: 2025-12-26_
_This file is actively monitored by the LLM at every session start_
_The LLM will process problems from the "PASTE YOUR PROBLEMS HERE" section_
